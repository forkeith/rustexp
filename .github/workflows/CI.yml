name: Build

on: [push, pull_request]

env:
    CARGO_TERM_COLOR: always

jobs:
  build_test:
    name: Build and Test
    runs-on: ubuntu-latest
    steps:
        - name: Checkout
          uses: actions/checkout@v3

        - name: Install Rust
          uses: dtolnay/rust-toolchain@stable

        - name: Run tests
          run: cargo test --all-features

  deploy_docs:
    name: Deploy site
    needs: build_test
    if: github.ref == 'refs/heads/main' && github.event_name != 'pull_request'
    uses: ./.github/workflows/Deploy.yml
    with:
      branch: main
